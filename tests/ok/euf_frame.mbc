(* Testing that the presence of the frame macro triggers
 * the collection of hashed messages in conditions.
 * In this example, the name n is hashed in the condition
 * of an action, and it be taken into account by EUF when
 * applied on an equality featuring the frame macro. *)

hash h
name n : message
name k : message
channel c

abstract u : message

system in(c,x); if x=h(n,k) then out(c,x).

goal forall tau:timestamp, frame@tau = h(u,k) => False.
Proof.
  intros.
  (* EUF should create two subgoals because h(n,k) occurs
   * in the actions of both branches of the conditional.
   * In each case we have u=n, thus False because n does
   * not occur in u. *)
  nosimpl(euf M0).
  simpl.
  simpl.
Qed.
