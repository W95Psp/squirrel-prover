channel c
abstract ok:message

system in(c,x); if x=ok && x<>ok then out(c,x).

equiv test.
Proof.
induction t.
case t.

expand frame@init.
expand exec@init.

expand frame@A.
expand exec@A.
equivalent cond@A, False.
expand cond@A.

fa 1.
noif 2.
simpl.

fa 0.
assumption.

expand frame@A1.
expand output@A1.
fa 1.
fa 2.
dup 2.
expand exec@A1.
expand cond@A1.
fa 0.
fa 1; fa 1.

(* TODO : requires a smart dup. *)
admit.

expand frame@init.
expand exec@init.


Qed.
