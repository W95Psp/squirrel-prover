hash h
name k:message
channel c
name n:message
name m:message
system null.

(* Test direct case *)
equiv test : h(diff(m,n),k),h(diff(n,m),k) .
Proof.
prf 1.

yesif 1.
project.

prf 0.
yesif 0.
project.
Qed.


system [test]  in(c,x); let surp = diff(m,n) in let mac = h(<x,surp>,k) in  out(c,mac); out(c,h(diff(<x,n>,<x,m>),k)).

equiv [left,test] [right,test] test2.
Proof.

induction t.
expandall.

fa 1. fa 2. prf 2.
(* easy case, it is the firt produced hash. *)
yesif 2.
project.
case H0.
case H0.

expandall.

fa 1; fa 2. prf 2. yesif 2.
project.

(* Here, if the macros are not correclty projected, we cannot prove the goal,
else it is automatically simplified. *)
case H0.
depends A, A1.

case H0.
depends A, A1.

Qed.
